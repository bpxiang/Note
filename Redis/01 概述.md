# 概述
>time: 2018-02-25 11:13:32  

Redis 是一种基于键值对（key-value）的 NoSQL 数据库，与很多键值对数据库不同的是，Redis 中的值可以是由 string（字符串）、hash（哈希）、list（列表）、set（集合）、zset（有序集合）、Bitmaps（位图）、HyperLogLog、GEO（地理信息定位）等多种数据结构和算法组成，因此 Redis 可以满足很多的应用场景，而且因为 Redis 会将所有数据都存放在内存中，所以它的读写性能非常惊人。不仅如此，Redis 还可以将内存的数据利用快照和日志的形式保存到硬盘上，这样在发生类似断电或者机器故障的时候，内存中的数据不会“丢失”。除了上述功能以外，Redis 还提供了键过期、发布订阅、事务、流水线、Lua 脚本等附加功能。总之，如果在合适的场景使用好 Redis，它就会像一把瑞士军刀一样所向披靡。

## 1. Redis 特性 
1. 速度快
    >正常情况下，Redis 执行命令的速度非常快，官方给出的数字是读写性能可以达到 10万/秒，当然这也取决于机器的性能，但这里先不讨论机器性能上的差异，只分析一下是什么造就了 Redis 除此之快的速度，可以大致归纳为以下四点：
    1. Redis 的所有数据都是存放在内存中的，把数据放在内存中是 Redis 速度快的最主要原因。
    1. Redis 是用 C 语言实现的，一般来说C语言实现的程序“距离”操作系统更近，执行速度相对会更快。
    1. Redis 使用了单线程架构，预防了多线程可能产生的竞争问题。
    1. 作者对于 Redis 源代码可以说是精打细磨，曾经有人评价 Redis 是少有的集性能和优雅于一身的开源代码。

    #### 谷歌公司给出的各层硬件执行速度
    | 层级 | 速度 |
    |---|---:|
    | L1 cache reference | 0.5 ns |
    | Branch mispredict | 5 ns |
    | L2 cache reference | 7 ns |
    | Mutex lock/unlock | 25 ns |
    | Main memory reference | 100 ns |
    | Compress 1K bytes with Zippy | 3 000 ns |
    | Send 2k bytes over 1 Gbps network | 20 000 ns |
    | Read 1 MB sequentially from Memory | 250 000 ns |
    | Round trip within same datacenter | 500 000 ns |
    | Disk seek | 10 000 000 ns |
    | Read 1 MB sequentially from disk | 20 000 000 ns |
    | Send packet CA->Netherlands->CA | 150 000 000 ns |

1. 基于键值对的数据结构服务器
    >几乎所有的编程语言都提供了类似字典的功能，例如 Java 里的 map、Python 里的dict，类似于这种组织数据的方式叫作基于键值的方式，与很多键值对数据库不同的是，Redis 中的值不仅可以是字符串，而且还可以是具体的数据结构，这样不仅能便于在许多应用场景的开发，同时也能够提高开发效率。Redis 的全称是 `REmote Dictionary Server`，它主要提供了5种数据结构：字符串、哈希、列表、集合、有序集合，同时在字符串的基础之上演变出了位图（Bitmaps）和 HyperLogLog 两种神奇的“数据结构”，并且随着 LBS（Location Based Service，基于位置服务）的不断发展，Redis3.2 版本中加入有关 GEO（地理信息定位）的功能，总之在这些数据结构的帮助下，开发者可以开发出各种“有意思”的应用。

1. 丰富的功能
    >除了5种数据结构，Redis还提供了许多额外的功能：
    1. 提供了键过期功能，可以用来实现缓存。
    1. 提供了发布订阅功能，可以用来实现消息系统。
    1. 支持Lua脚本功能，可以利用Lua创造出新的Redis命令。
    1. 提供了简单的事务功能，能在一定程度上保证事务特性。
    1. 提供了流水线（Pipeline）功能，这样客户端能将一批命令一次性传到Redis，减少了网络的开销。
1. 简单
    >Redis 的简单主要表现在三个方面。首先，Redis 的源码很少，早期版本的代码只有2万行左右，3.0 版本以后由于添加了集群特性，代码增至 5 万行左右，相对于很多 NoSQL 数据库来说代码量相对要少很多，也就意味着普通的开发和运维人员完全可以“吃透”它。其次，Redis 使用单线程模型，这样不仅使得 Redis 服务端处理模型变得简单，而且也使得客户端开发变得简单。最后，Redis 不需要依赖于操作系统中的类库（例如 Memcache 需要依赖 libevent 这样的系统类库），Redis 自己实现了事件处理的相关功能。

    >Redis 虽然很简单，但是不代表它不稳定。以笔者维护的上千个 Redis 为例，没有出现过因为 Redis 自身 bug 而宕掉的情况。

1. 客户端语言多
    >Redis 提供了简单的 TCP 通信协议，很多编程语言可以很方便地接入到 Redis，并且由于 Redis 受到社区和各大公司的广泛认可，所以支持 Redis 的客户端语言也非常多，几乎涵盖了主流的编程语言，例如J ava、PHP、Python、C、C++、Nodejs 等。

1. 持久化
    >通常看，将数据放在内存中是不安全的，一旦发生断电或者机器故障，重要的数据可能就会丢失，因此 Redis 提供了两种持久化方式：RDB 和 AOF，即可以用两种策略将内存的数据保存到硬盘中，这样就保证了数据的可持久性。

1. 主从复制
    >Redis 提供了复制功能，实现了多个相同数据的 Redis 副本，复制功能是分布式 Redis 的基础。

1. 高可用和分布式
    >Redis 从 2.8 版本正式提供了高可用实现 Redis Sentinel，它能够保证 Redis 节点的故障发现和故障自动转移。Redis 从 3.0 版本正式提供了分布式实现 Redis Cluster，它是 Redis 真正的分布式实现，提供了高可用、读写和容量的扩展性。

## 2. Redis 使用场景
### 1. Redis 可以做什么
1. 缓存
    >缓存机制几乎在所有的大型网站都有使用，合理地使用缓存不仅可以加快数据的访问速度，而且能够有效地降低后端数据源的压力。Redis提供了键值过期时间设置，并且也提供了灵活控制最大内存和内存溢出后的淘汰策略。可以这么说，一个合理的缓存设计能够为一个网站的稳定保驾护航。

1. 排行榜系统
    >排行榜系统几乎存在于所有的网站，例如按照热度排名的排行榜，按照发布时间的排行榜，按照各种复杂维度计算出的排行榜，Redis提供了列表和有序集合数据结构，合理地使用这些数据结构可以很方便地构建各种排行榜系统。

1. 计数器应用
    >计数器在网站中的作用至关重要，例如视频网站有播放数、电商网站有浏览数，为了保证数据的实时性，每一次播放和浏览都要做加1的操作，如果并发量很大对于传统关系型数据的性能是一种挑战。Redis天然支持计数功能而且计数的性能也非常好，可以说是计数器系统的重要选择。

1. 社交网络
    >赞/踩、粉丝、共同好友/喜好、推送、下拉刷新等是社交网站的必备功能，由于社交网站访问量通常比较大，而且传统的关系型数据不太适合保存这种类型的数据，Redis提供的数据结构可以相对比较容易地实现这些功能。

1. 消息队列系统
    >消息队列系统可以说是一个大型网站的必备基础组件，因为其具有业务解耦、非实时业务削峰等特性。Redis提供了发布订阅功能和阻塞队列的功能，虽然和专业的消息队列比还不够足够强大，但是对于一般的消息队列功能基本可以满足。

### 2. Redis 不可以做什么
实际上和任何一门技术一样，每个技术都有自己的应用场景和边界，也就是说Redis并不是万金油，有很多适合它解决的问题，但是也有很多不合适它解决的问题。我们可以站在数据规模和数据冷热的角度来进行分析。

站在数据规模的角度看，数据可以分为大规模数据和小规模数据，我们知道Redis的数据是存放在内存中的，虽然现在内存已经足够便宜，但是如果数据量非常大，例如每天有几亿的用户行为数据，使用Redis来存储的话，基本上是个无底洞，经济成本相当的高。

站在数据冷热的角度看，数据分为热数据和冷数据，热数据通常是指需要频繁操作的数据，反之为冷数据，例如对于视频网站来说，视频基本信息基本上在各个业务线都是经常要操作的数据，而用户的观看记录不一定是经常需要访问的数据，这里暂且不讨论两者数据规模的差异，单纯站在数据冷热的角度上看，视频信息属于热数据，用户观看记录属于冷数据。如果将这些冷数据放在 Redis 中，基本上是对于内存的一种浪费，但是对于一些热数据可以放在 Redis 中加速读写，也可以减轻后端存储的负载，可以说是事半功倍。

所以，Redis 并不是万金油，相信随着我们对 Redis 的逐步学习，能够清楚 Redis 真正的使用场景。

## 3. 用好 Redis 的建议
1. 切勿当作黑盒使用，开发与运维同样重要
    >很多使用 Redis 的开发者认为只要会用 API 开发相应的功能就可以，更有甚者认为 Redis 就是 get、set、del，不需要知道 Redis 的原理。但是在我们实际运维和使用 Redis 的过程中发现，很多线上的故障和问题都是由于完全把 Redis 当做黑盒造成的，如果不了解 Redis 的单线程模型，有些开发者会在有上千万个键的 Redis 上执行 keys* 操作，如果不了解持久化的相关原理，会在一个写操作量很大的 Redis 上配置自动保存 RDB。而且在很多公司内只有专职的关系型数据库 DBA，并没有 NoSQL 的相关运维人员，也就是说开发者很有可能会自己运维 Redis，对于Redis的开发者来说既是好事又是坏事。站在好的方面看，开发人员可以通过运维 Redis 真正了解 Redis 的一些原理，不单纯停留在开发上。站在坏的方面看， Redis 的开发人员不仅要支持开发，还要承担运维的责任，而且由于运维经验不足可能会造成线上故障。但是从实际经验来看，运维足够足够规模的 Redis 会对用好 Redis 更加有帮助。

1. 阅读源码
    >我们在前面提到过，Redis 是开源项目，由于作者对Redis代码的极致追求，Redis 的代码量相对于许多 NoSQL 数据库来说是非常小的，也就意味着作为普通的开发和运维人员也是可以“吃透” Redis 的。通过阅读优秀的源码，不仅能够加深我们对于 Redis 的理解，而且还能提高自身的编码水平，甚至可以对 Redis 做定制化，也就是说可以修改 Redis 的源码来满足自身的需求，例如新浪微博在 Redis 的早期版本上做了很多的定制化来满足自身的需求，豌豆荚也开源基于 Proxy 的 Redis 分布式实现 Codis。
